# Проектирование сервиса категорий

## Функциональность

- **Добавление новых и удаление категорий.**
- **Генерация и предоставление данных о дереве категорий:** Преобразует иерархию категорий в структурированный формат (дерево).
- **Обеспечение уникальности имени категории в иерархии:** Имя всех категорий будет уникальным вне зависимости от иерархии.
- **Работа с базой данных.**
- **Обработка ошибок:** Обработка сценариев, если категория не найдена или нарушена уникальность.
- **Использование кэширования:** Для ускорения обработки и минимизации обращений к базе данных будет применяться кэширование (например, для дерева категорий).

## Варианты использования

### 1. Добавление корневой категории
**Цель:** Система добавляет новую категорию на самый верхний уровень иерархии.

**Основной поток:**
1. Актор отправляет запрос на добавление категории, передавая данные:
    - Имя категории: Название новой категории.
2. Система проверяет:
    - Убедиться, что категория с таким именем не существует среди всех категорий.
    - Если существует, возвращается ошибка с сообщением.
3. Если имя уникально:
    - Система сохраняет категорию в базу данных.
    - Кэш обновляется.
4. Система возвращает подтверждение успешного добавления с информацией о категории:
    - Имя категории.
    - Статус: "успешно добавлено".

### 2. Добавление дочерней категории
**Цель:** Система добавляет новую категорию в качестве дочерней к существующей категории.

**Основной поток:**
1. Актор отправляет запрос на добавление дочерней категории, передавая данные:
    - Имя категории: Название новой категории.
    - Имя родительской категории: Идентификатор (название) существующей категории, к которой привязывается новая.
2. Система выполняет проверки:
    - Убедиться, что категория с таким именем не существует среди всех категорий.
    - Убедиться, что родительская категория существует.
3. Если проверки прошли успешно:
    - Система сохраняет новую категорию с привязкой к указанной родительской категории в базу данных.
    - Кэш обновляется.
4. Система возвращает подтверждение успешного добавления с информацией о новой категории:
    - Имя категории.
    - Имя родительской категории.
    - Статус: "успешно добавлено".

### 3. Удаление категории
**Цель:** Система удаляет существующую категорию из дерева категорий.

**Основной поток:**
1. Актор отправляет запрос на удаление категории, передавая данные:
    - Имя категории: Имя категории, которую нужно удалить.
2. Система выполняет проверки:
    - Убедиться, что категория с указанным именем существует.
    - Если не существует, возвращается ошибка.
3. Если проверки прошли успешно:
    - Система удаляет категорию и все её дочерние элементы из базы данных.
    - Кэш обновляется.
4. Система возвращает подтверждение успешного удаления:
    - Имя удаленной категории.
    - Статус: "успешно удалено".

**Дополнительно:** При удалении категории автоматически удаляются все её дочерние элементы, чтобы избежать "осиротевших" записей в базе данных. Для этого используется каскадное удаление и удаление осиротевших записей (cascade = ALL, orphanRemoval = true).

### 4. Получение категорий в виде дерева
**Цель:** Система предоставляет иерархию категорий в виде дерева, чтобы пользователь мог видеть структуру всех категорий и их дочерних элементов.

**Основной поток:**
1. Актор отправляет запрос на получение дерева категорий (не требуется дополнительных параметров).
2. Система обрабатывает запрос:
    - Получает все категории, у которых отсутствует родительская категория.
    - Использует алгоритм для построения дерева категорий с учётом иерархии.
3. Система возвращает структуру данных в формате JSON, где дочерние категории вложены в соответствующие родительские элементы.

**Дополнительно:** Модель категории должна содержать информацию о своём родителе (ID родительской категории), чтобы корректно построить иерархию.

## Примечания

- При реализации использован принцип **"один ко многим"** для связи между родительской категорией и дочерними.
- В системе используется **кэширование** для ускорения работы с деревом категорий.


# Как использовать сервис

## 1. Запрос на получение дерева категорий
**Метод:** GET  
**URL:** `http://localhost:8080/api/categories`

### Описание:
Этот запрос возвращает дерево категорий, то есть все категории с их дочерними элементами.

### Пример запроса:
 GET `http://localhost:8080/api/categories`

### 2. Запрос на добавление корневой категории
**Метод:** POST  
**URL:** `http://localhost:8080/api/categories`

Этот запрос позволяет добавить новую категорию на самый верхний уровень иерархии. Корневая категория не имеет родительской категории.

#### Параметры запроса:
- **categoryName**: Название новой корневой категории (обязательное поле).

#### Пример запроса:
POST `http://localhost:8080/api/categories \
     -H "Content-Type: application/json" \
     -d '{"categoryName": "Новая корневая категория"}`

### 3. Запрос на удаление категории
**Метод:** DELETE  
**URL:** `http://localhost:8080/api/categories/{categoryName}`

Этот запрос удаляет категорию по имени и все её дочерние элементы из базы данных.

#### Параметры запроса:
- **categoryName**: Имя категории, которую нужно удалить (обязательное поле).

#### Пример запроса:
DELETE `http://localhost:8080/api/categories/Категория_1`


### 4. Запрос на добавление дочерней категории
**Метод:** POST  
**URL:** `http://localhost:8080/api/categories/{parentCategoryName}`

Этот запрос добавляет новую категорию в качестве дочерней к уже существующей категории.

#### Параметры запроса:
- **categoryName**: Название новой дочерней категории (обязательное поле).
- **parentCategoryName**: Имя родительской категории, к которой привязывается новая категория (передается в URL).

#### Пример запроса:
POST `http://localhost:8080/api/categories/Категория_1 \
     -H "Content-Type: application/json" \
     -d '{"categoryName": "Новая дочерняя категория"}`

